# PBN 지능형 링크 빌딩 시스템 가이드

## 🎯 개요

이 시스템은 기존 PBN 백링크 자동화 시스템에 지능형 링크 빌딩 기능을 추가한 고도화 버전입니다.

### 🔥 새로운 기능들

1. **자동 PBN 콘텐츠 크롤링**: 모든 PBN 사이트의 블로그 글을 수집
2. **지능형 유사도 검사**: AI 기반 텍스트 유사도로 관련 콘텐츠 찾기
3. **자동 링크 삽입**: 클라이언트 링크 100% + 내부링크 자동 생성
4. **링크 품질 관리**: 유사도 점수 기반 고품질 링크만 선별

## 📦 설치 방법

### 1단계: 기본 의존성 설치

```bash
# 기존 requirements.txt 설치
pip install -r requirements.txt

# 새로운 링크 시스템 의존성 설치
pip install -r requirements_link_system.txt
```

### 2단계: 추가 패키지 설치 (중요!)

```bash
# 텍스트 유사도 계산을 위한 라이브러리
pip install sentence-transformers scikit-learn numpy

# 웹 크롤링 관련
pip install requests urllib3
```

### 3단계: 시스템 테스트

```bash
# 테스트 스크립트 실행
python test_link_system.py
```

## 🚀 사용 방법

### 1. 기본 실행

```bash
python enhanced_main_v2.py
```

### 2. 새로운 메뉴 항목들

시스템을 실행하면 다음과 같은 새로운 메뉴 항목들을 볼 수 있습니다:

```
21. 🔗 PBN 콘텐츠 크롤링 (링크 데이터베이스 구축)
22. 📊 PBN 콘텐츠 데이터베이스 통계 조회
23. 🔍 키워드 기반 유사 포스트 검색 테스트
```

### 3. 첫 번째 사용 전 준비사항

#### 3-1. PBN 콘텐츠 크롤링 실행

```
메뉴에서 21번 선택 → PBN 콘텐츠 크롤링 실행
```

- **목적**: 모든 PBN 사이트의 블로그 글 제목과 URL을 수집
- **소요시간**: PBN 사이트 수에 따라 10분~1시간
- **결과**: `pbn_content_database.db` 파일에 데이터 저장

#### 3-2. 데이터베이스 상태 확인

```
메뉴에서 22번 선택 → 통계 조회
```

예상 출력:
```
📊 PBN 콘텐츠 데이터베이스 통계
==================================================
📄 총 포스트 수: 10,234개
🌐 총 사이트 수: 34개

📋 사이트별 포스트 수 (상위 10개):
   • https://example-pbn1.com: 1,245개
   • https://example-pbn2.com: 987개
   ...
```

#### 3-3. 유사도 검색 테스트

```
메뉴에서 23번 선택 → 키워드 입력하여 테스트
```

## 🔧 시스템 작동 원리

### 1. 콘텐츠 생성 시 자동 링크 삽입 과정

1. **콘텐츠 생성**: 기존과 동일하게 AI가 콘텐츠 생성
2. **키워드 추출**: 메인키워드, LSI키워드, 롱테일키워드 추출
3. **클라이언트 링크**: 메인키워드에 클라이언트 URL 100% 삽입
4. **유사도 검색**: PBN 데이터베이스에서 관련 포스트 검색
5. **내부링크 삽입**: 유사도 높은 포스트들을 내부링크로 추가
6. **최종 검증**: 링크 품질 및 밀도 검사

### 2. 링크 품질 관리

- **유사도 임계값**: 0.3 이상인 포스트만 링크 대상
- **링크 밀도**: 전체 콘텐츠의 3% 이하로 제한
- **앵커텍스트 다양화**: 키워드 변형으로 자연스러운 링크
- **링크 위치 최적화**: 콘텐츠 내 적절한 위치에 분산 배치

## 📊 성능 및 효과

### 예상 개선 효과

- **클라이언트 링크**: 100% 확실한 삽입 보장
- **내부링크**: 평균 3-5개 관련성 높은 링크 자동 생성
- **SEO 점수**: 기존 대비 30-50% 향상 예상
- **작업 효율**: 수동 링크 작업 시간 90% 단축

### 시스템 리소스

- **데이터베이스 크기**: 10,000개 포스트 기준 약 50MB
- **메모리 사용량**: 유사도 모델 로딩 시 약 500MB
- **처리 속도**: 포스트당 링크 빌딩 5-10초

## 🛠️ 문제 해결

### 자주 발생하는 문제들

#### 1. 모듈 Import 오류

```bash
ImportError: No module named 'sentence_transformers'
```

**해결방법:**
```bash
pip install sentence-transformers scikit-learn numpy
```

#### 2. 유사도 모델 다운로드 실패

```bash
urllib.error.URLError: <urlopen error [Errno 11001] getaddrinfo failed>
```

**해결방법:**
- 인터넷 연결 확인
- 방화벽/프록시 설정 확인
- VPN 사용 시 연결 상태 확인

#### 3. PBN 사이트 크롤링 실패

```bash
❌ API 요청 실패: 404
```

**해결방법:**
- PBN 사이트 URL 확인 (https:// 포함)
- WordPress REST API 활성화 확인
- 사이트 접근 권한 확인

#### 4. 메모리 부족 오류

```bash
MemoryError: Unable to allocate array
```

**해결방법:**
- 동시 크롤링 사이트 수 줄이기 (기본값: 3)
- 시스템 메모리 확인 (최소 4GB 권장)

### 로그 파일 위치

- **크롤링 로그**: `pbn_content_database.db` (SQLite)
- **링크 빌딩 로그**: `data/` 디렉토리의 JSON 파일들
- **디버그 데이터**: `data/키워드_단계_타임스탬프.확장자` 형식

## 🔍 고급 설정

### 링크 빌딩 파라미터 조정

`intelligent_link_builder.py` 파일의 `config` 설정:

```python
self.config = {
    'external_link_probability': 1.0,      # 외부링크(클라이언트) 100% 확률
    'internal_link_probability': 0.7,      # 내부링크 70% 확률
    'max_internal_links': 5,               # 최대 내부링크 수
    'max_external_links': 3,               # 최대 외부링크 수
    'min_similarity_score': 0.3,           # 최소 유사도 점수
    'link_density_limit': 0.03,            # 링크 밀도 제한 (3%)
}
```

### 크롤링 설정 조정

`pbn_content_crawler.py` 파일의 크롤링 설정:

```python
# 최대 페이지 수 (사이트당)
max_pages = 50

# 페이지당 포스트 수
per_page = 100

# 요청 간격 (초)
time.sleep(0.5)
```

## 📈 모니터링 및 분석

### 링크 빌딩 성과 추적

1. **링크 보고서**: 각 포스트별 삽입된 링크 정보
2. **유사도 점수**: 내부링크의 관련성 점수
3. **크롤링 통계**: PBN 사이트별 수집 현황
4. **시스템 성능**: 처리 시간 및 리소스 사용량

### 데이터베이스 관리

```sql
-- 포스트 수 확인
SELECT COUNT(*) FROM pbn_posts;

-- 사이트별 통계
SELECT site_url, COUNT(*) as post_count 
FROM pbn_posts 
GROUP BY site_url 
ORDER BY post_count DESC;

-- 최근 크롤링 로그
SELECT * FROM crawl_logs 
ORDER BY created_at DESC 
LIMIT 10;
```

## 🎯 추천 워크플로우

### 1. 시스템 설정 (최초 1회)

1. 의존성 설치
2. 테스트 스크립트 실행
3. PBN 콘텐츠 크롤링 실행
4. 데이터베이스 상태 확인

### 2. 일일 운영

1. 자동화된 백링크 캠페인 실행 (메뉴 1번)
2. 생성된 링크 보고서 확인
3. PBN 데이터베이스 주기적 업데이트

### 3. 주간 유지보수

1. PBN 콘텐츠 재크롤링
2. 데이터베이스 통계 분석
3. 링크 성과 분석
4. 시스템 설정 최적화

## 📞 지원 및 문의

시스템 사용 중 문제가 발생하면:

1. `test_link_system.py` 스크립트로 진단
2. 로그 파일 확인
3. 설정 파일 검증
4. 필요시 전문가 상담

---

**🎉 축하합니다! 이제 AI 기반의 지능형 링크 빌딩 시스템을 사용하실 수 있습니다.**
